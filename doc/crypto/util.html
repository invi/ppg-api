<!DOCTYPE html><html lang="en"><head><title>crypto/util</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="crypto/util"><meta name="groc-project-path" content="lib/crypto/util.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">lib/crypto/util.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><p>GPG4Browsers - An OpenPGP implementation in javascript
Copyright (C) 2011 Recurity Labs GmbH</p>

<p>This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.</p>

<p>This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.</p>

<p>You should have received a copy of the GNU Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">Util</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">hexdump</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">){</span>
          <span class="nx">h</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">c</span><span class="o">++</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
          <span class="k">while</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="nx">h</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
          <span class="nx">r</span><span class="o">+=</span><span class="s2">&quot; &quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
          <span class="nx">i</span><span class="o">++</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">32</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nx">r</span><span class="o">+=</span><span class="s2">&quot;\n           &quot;</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="cm">/**</span>
<span class="cm">   * create hexstring from a binary</span>
<span class="cm">   * @param str [String] string to convert</span>
<span class="cm">   * @return [String] string containing the hexadecimal values</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hexstrdump</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">str</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
      <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">){</span>
          <span class="nx">h</span><span class="o">=</span><span class="nx">str</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">].</span><span class="nx">charCodeAt</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
          <span class="k">while</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="nx">h</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
          <span class="nx">r</span><span class="o">+=</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="cm">/**</span>
<span class="cm">   * creating a hex string from an binary array of integers (0..255)</span>
<span class="cm">   * @param [Array[integer 0..255]] array to convert</span>
<span class="cm">   * @return [String] hexadecimal representation of the array</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hexidump</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">c</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">h</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="nx">e</span><span class="p">){</span>
          <span class="nx">h</span><span class="o">=</span><span class="nx">str</span><span class="p">[</span><span class="nx">c</span><span class="o">++</span><span class="p">].</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
          <span class="k">while</span><span class="p">(</span><span class="nx">h</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="nx">h</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
          <span class="nx">r</span><span class="o">+=</span><span class="s2">&quot;&quot;</span><span class="o">+</span><span class="nx">h</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * convert a string to an array of integers(0.255)</span>
<span class="cm">   * @param [String] string to convert</span>
<span class="cm">   * @return [Array [Integer 0..255]] array of (binary) integers</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">str2bin</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">str</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="cm">/**</span>
<span class="cm">   * convert an array of integers(0.255) to a string </span>
<span class="cm">   * @param [Array [Integer 0..255]] array of (binary) integers to convert</span>
<span class="cm">   * @return [String] string representation of the array</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">bin2str</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bin</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">bin</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">bin</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * calculates a 16bit sum of a string by adding each character codes modulus 65535</span>
<span class="cm">   * @param text [String] string to create a sum of</span>
<span class="cm">   * @return [Integer] an integer containing the sum of all character codes % 65535</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">calc_checksum</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">checksum</span> <span class="o">=</span> <span class="p">{</span>  <span class="nx">s</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sadd</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">s</span> <span class="o">+</span> <span class="nx">sadd</span><span class="p">)</span> <span class="o">%</span> <span class="mi">65536</span><span class="p">;</span> <span class="p">}};</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">checksum</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">i</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">checksum</span><span class="p">.</span><span class="nx">s</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Helper function to print a debug message. Debug </span>
<span class="cm">   * messages are only printed if</span>
<span class="cm">   * openpgp.config.debug is set to true. The calling</span>
<span class="cm">   * Javascript context MUST define</span>
<span class="cm">   * a &quot;showMessages(text)&quot; function. Line feeds (&#39;\n&#39;)</span>
<span class="cm">   * are automatically converted to HTML line feeds &#39;&lt;br/&gt;&#39;</span>
<span class="cm">   * @param str [String] string of the debug message</span>
<span class="cm">   * @return [String] an HTML tt entity containing a paragraph with a style attribute where the debug message is HTMLencoded in. </span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">print_debug</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">openpgp</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">str</span> <span class="o">=</span> <span class="nx">openpgp_encoding_html_encode</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
      <span class="nx">showMessages</span><span class="p">(</span><span class="s2">&quot;&lt;tt&gt;&lt;p style=\&quot;background-color: #ffffff; width: 652px; word-break: break-word; padding: 5px; border-bottom: 1px solid black;\&quot;&gt;&quot;</span><span class="o">+</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/p&gt;&lt;/tt&gt;&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Helper function to print an error message. </span>
<span class="cm">   * The calling Javascript context MUST define</span>
<span class="cm">   * a &quot;showMessages(text)&quot; function. Line feeds (&#39;\n&#39;)</span>
<span class="cm">   * are automatically converted to HTML line feeds &#39;&lt;br/&gt;&#39;</span>
<span class="cm">   * @param str [String] string of the error message</span>
<span class="cm">   * @return [String] a HTML paragraph entity with a style attribute containing the HTML encoded error message</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">print_error</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">openpgp_encoding_html_encode</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
    <span class="nx">showMessages</span><span class="p">(</span><span class="s2">&quot;&lt;p style=\&quot;font-size: 80%; background-color: #FF8888; margin:0; width: 652px; word-break: break-word; padding: 5px; border-bottom: 1px solid black;\&quot;&gt;&lt;span style=\&quot;color: #888;\&quot;&gt;&lt;b&gt;ERROR:&lt;/b&gt;&lt;/span&gt; &quot;</span><span class="o">+</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Helper function to print an info message. </span>
<span class="cm">   * The calling Javascript context MUST define</span>
<span class="cm">   * a &quot;showMessages(text)&quot; function. Line feeds (&#39;\n&#39;)</span>
<span class="cm">   * are automatically converted to HTML line feeds &#39;&lt;br/&gt;&#39;.</span>
<span class="cm">   * @param str [String] string of the info message</span>
<span class="cm">   * @return [String] a HTML paragraph entity with a style attribute containing the HTML encoded info message</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">print_info</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">openpgp_encoding_html_encode</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
    <span class="nx">showMessages</span><span class="p">(</span><span class="s2">&quot;&lt;p style=\&quot;font-size: 80%; background-color: #88FF88; margin:0; width: 652px; word-break: break-word; padding: 5px; border-bottom: 1px solid black;\&quot;&gt;&lt;span style=\&quot;color: #888;\&quot;&gt;&lt;b&gt;INFO:&lt;/b&gt;&lt;/span&gt;  &quot;</span><span class="o">+</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">print_warning</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">str</span> <span class="o">=</span> <span class="nx">openpgp_encoding_html_encode</span><span class="p">(</span><span class="nx">str</span><span class="p">);</span>
    <span class="nx">showMessages</span><span class="p">(</span><span class="s2">&quot;&lt;p style=\&quot;font-size: 80%; background-color: #FFAA88; margin:0; width: 652px; word-break: break-word; padding: 5px; border-bottom: 1px solid black;\&quot;&gt;&lt;span style=\&quot;color: #888;\&quot;&gt;&lt;b&gt;WARNING:&lt;/b&gt;&lt;/span&gt; &quot;</span><span class="o">+</span><span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/p&gt;&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">getLeftNBits</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">string</span><span class="p">,</span> <span class="nx">bitcount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">bitcount</span> <span class="o">%</span> <span class="mi">8</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rest</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">bitcount</span> <span class="o">/</span> <span class="mi">8</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">bytes</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bitcount</span> <span class="o">-</span> <span class="nx">rest</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">string</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">shiftRight</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="mi">8</span><span class="o">-</span><span class="nx">rest</span><span class="p">);</span> <span class="c1">// +String.fromCharCode(string.charCodeAt(bytes -1) &lt;&lt; (8-rest) &amp; 0xFF);</span>
  <span class="p">};</span>
  <span class="cm">/**</span>
<span class="cm">   * Shifting a string to n bits right</span>
<span class="cm">   * @param value [String] the string to shift</span>
<span class="cm">   * @param bitcount [Integer] amount of bits to shift (MUST be smaller than 9)</span>
<span class="cm">   * @return [String] resulting string. </span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">shiftRight</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">bitcount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">str2bin</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">bitcount</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">temp</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">temp</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="nx">bitcount</span> <span class="o">%</span> <span class="mi">8</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
              <span class="nx">temp</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">temp</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="p">(</span><span class="nx">bitcount</span> <span class="o">%</span> <span class="mi">8</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">util</span><span class="p">.</span><span class="nx">bin2str</span><span class="p">(</span><span class="nx">temp</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Return the algorithm type as string</span>
<span class="cm">   * @return [String] String representing the message type</span>
<span class="cm">   */</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">get_hashAlgorithmString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">algo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span><span class="p">(</span><span class="nx">algo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;MD5&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;SHA1&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;RIPEMD160&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">8</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;SHA256&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">9</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;SHA384&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">10</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;SHA512&quot;</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">11</span><span class="o">:</span>
      <span class="k">return</span> <span class="s2">&quot;SHA224&quot;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s2">&quot;unknown&quot;</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * an instance that should be used. </span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Util</span><span class="p">();</span>

<span class="cm">/* </span>
<span class="cm"> * adaptation to commonjs</span>
<span class="cm"> */</span>
<span class="kd">var</span> <span class="nx">openpgp</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">config</span> <span class="o">:</span> <span class="p">{</span> <span class="nx">debug</span> <span class="o">:</span> <span class="kc">false</span> <span class="p">}</span> <span class="p">};</span>
<span class="kd">function</span> <span class="nx">openpgp_encoding_html_encode</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">};</span>
<span class="kd">function</span> <span class="nx">showMessages</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span> 
  <span class="k">if</span> <span class="p">(</span><span class="nx">openpgp</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> 
<span class="p">};</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">util</span> <span class="o">=</span> <span class="nx">util</span><span class="p">;</span></div></div></div></div></body></html>